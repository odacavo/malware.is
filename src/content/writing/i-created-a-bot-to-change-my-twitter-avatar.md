---
title: "I Created A Bot To Change My Twitter Avatar"
date: "2022-03-04"
slug: "i-created-a-bot-to-change-my-twitter-avater"

description: "I got bored of having a static profile picture. I created the twitter-avatar-bot to automatically change my Twitter profile picture on a configurable schedule by pulling images from an images directory."
tags: ["development"]
---
###  Follow me on Twitter! [@odacavo](https://twitter.com/odacavo)
View the source code for this project: [GitHub](https://github.com/odacavo/twitter-avatar-bot/)

![twitter-avatar-bot Cover Photo](https://camo.githubusercontent.com/9cb0d9435180515ad573fd7891456d39e564640c8c2f2bf399b77c77389a345a/68747470733a2f2f692e696d6775722e636f6d2f4864436265695a2e706e67)
{class-postImageCaption}twitter-avatar-bot Cover Photo{/}


## My History with the Twitter API
I've played around with the Twitter API before to test out some other project ideas. In fact, in a younger and more naive life (a few years ago ðŸ˜³), I wrote a Twitter bot to parse [Canada's War Honour Roll dataset](https://open.canada.ca/data/en/dataset/792bb73a-f758-4459-b7e9-0c286a0bc15d) to recognize the respective men and women of the military who passed, "on this day in history". My app worked, and was tweeting! So much so that the Canadian Virtual War Memorial (CVWM) had acknowledged in support of the project. However, I did mention I was naive - and by that I mean I was far less security-aware. 

I pushed my changes to GitHub to show off this sweet project aaaand.... I woke up to find the Twitter account completely defaced! The amazing Twitter bot I created was now posting obscene messages and photos in a different language. I didn't do this! How did this happen? Someone had somehow accessed my trusted Twitter API endpoints to post their own media to the account I connected it to. That's when I quickly learned I had accidentally committed my Twitter API keys to GitHub, and hardcoded them without using environment variables. 

Now, this is obviously an embarrassing mistake - anyone who has done any sort of development before knows to hide API keys (they're literally called SECRETS!), especially when pushing a repository to the public Internet. I don't blame you for laughing at my ineptitude, but the silver lining is that I did learn from this. I also learned that there are bots that are constantly scanning GitHub for various API keys because they all use common syntax that can be searched. And when an API key is found, these bots will test them, and that's when they can become malicious.

## twitter-avatar-bot
I wanted a unique avatar to use on various social media, my website, etc. to represent whatever an *odacavo* is. Yeah, *odacavo* is an anagram for *avocado* ðŸ¥‘, but I didn't want to use an icon of an avocado, because I didn't want to [get sued by Apple](https://www.entrepreneur.com/article/354644). No, for real though. I messed around in Illustrator for a bit and came up with a simple ghost-looking thing.

![odacavo Avatar](/images/writing/i-created-a-bot-to-change-my-twitter-avatar/100.jpg)
{class-postImageCaption}odacavo Avatar{/}

I've made a few tweaks since, but I've been using it almost every for about a year now. I realized though, it's such a simple icon and it would be cool to make it less static. Twitter [removed the option for animated avatars back in 2012](https://www.dailydot.com/unclick/twitter-animated-gif-avatars/), so that was out of the question. I used to have one! It was sweet! I could have been grandfathered in if I never changed it.

Anyways, I remembered that it was possible to change your Twitter profile picture through the API because of my previously embarrassing  mishap. I thought it might be cool to write a script to make the API call to change my profile picture every minute, hour, or day. It might be a little jarring if I changed it to completely different photos each time, so I decided to make a number of variations of my current avatar, just by swapping the colors around a bit. That way, it's still *me*, but I'll get a fresh variation of *me* every hour, on the hour! Did I mention I was bored and there's not much to do these days?

Anyways, I started up a project using node.js, because I was familiar with doing some node projects in the past and knew that I could spin something up quickly on Heroku.

## twitter-api-v2
The crux of this project was solved by a well-maintained, light, versatile yet powerful Twitter API client for Node.js called [twitter-api-v2](https://www.npmjs.com/package/twitter-api-v2). This package does all of the heavy lifting and translating when it comes to making requests to Twitter's API.

``` bash
yarn add twitter-api-v2
# or
npm i twitter-api-v2
```

If you don't have a Twitter API key, you must register your "app" on the [Twitter Developer Portal](https://developer.twitter.com/) and get approved for elevated access. You first have to be "approved", but it is as simple as filling out a few forms, and then you're given the required secrets. Ensure you set it to include "write" access, as we'll be making POST requests to the profile picture endpoint.

From there, I created a simple `twitterClient.js` file to make the initial connections and configure my Twitter API keys.


### `twitterClient.js`

``` js
//Require environment variables from .env file
require('dotenv').config();

const { TwitterApi } = require('twitter-api-v2');

const twitterClient = new TwitterApi({
    appKey: process.env.APPKEY,
    appSecret: process.env.APPSECRET,
    accessToken: process.env.ACCESSTOKEN,
    accessSecret: process.env.ACCESSSECRET
});

const rwClient = twitterClient.readWrite;

module.exports = rwClient
```

You can see I'm using the NPM [dotenv](https://www.npmjs.com/package/dotenv) package to configure environment variables and tokenize my API keys. For a super simple tutorial on how to do this, check out [The Coding Train on YouTube](https://www.youtube.com/watch?v=17UVejOw3zA).

Then, I import the `twitter-api-v2` package and configure arguments for the required API keys. After which, I then simply export it as a read/write client for later use. I decided to partition the twitter "client" and my app logic into two separate files to differentiate them, but you could do this all in an `index.js` file.

In my `index.js` file, I contain all of the logic to import the required packages, pick a random image, and set it as my profile picture inside an asynchronous function. I then use cron to schedule this function every hour. 


### `index.js`

``` js
const rwClient = require('./twitterClient.js');
const CronJob = require("cron").CronJob;


//Function to call the profile picture update API endpoint
const ppUpdate = async () => {
    try {
        //Select a random image index
        const imagesLength = 25;
        const randomIndex = Math.floor(Math.random() * imagesLength);
        await rwClient.v1.updateAccountProfileImage('./images/' + randomIndex + '.png')
        console.log("Profile picture updated to " + randomIndex + ".png")
    } catch (e) {
        console.error(e)
    }
}


//Set the cron interval to run ppUpdate - curently set to every hour
const job = new CronJob("0 * * * *", () => {
    ppUpdate()
})

job.start();
```

This script is purpose-built. I wanted it to pick a random image from an `/images` folder, and set that as my profile picture once an hour. Because of this, I didn't feel the need to have node look through the file system to randomly select an image by file-name. I saved a lot of time with this decision, and wrote the logic to just use `Math.random()` to pick a random number between 0 and the total number of images in the `/images` directory. Again, I'm not reading the file system here, so I hardcoded `25` because I have 25 images in my `/images` folder.

To build the image's path, I just hardcode my directory `'./images/'`, add the randomly selected number, and tack on the file extension `.png`. My images folder contains images named `0.png` all the way up to `24.png` (computers count from 0). It's a simple hack for making a purpose-built script more lightweight.

The rest of the script is twitter-api-v2 logic for making the request, error logging, and scheduling with `cron`. I use NPM's [cron](https://www.npmjs.com/package/cron) package to call the `ppUpdate` function every hour, on the hour in an arrow function `("0 * * * *",`.


## Conclusion

That's about it! It's nothing special, super simple, and probably serves itself for more elegant solutions out there, but this is the way I went about it. If you're trying this out yourself and have questions or issues, feel free to reach out on Twitter [@odacavo](https://twitter.com/odacavo) and I'll get back to you!

View the source code for this project: [GitHub](https://github.com/odacavo/twitter-avatar-bot/)

 ## References:
- [https://github.com/odacavo/twitter-avatar-bot/](https://github.com/odacavo/twitter-avatar-bot/)
- [https://www.npmjs.com/package/twitter-api-v2](https://www.npmjs.com/package/twitter-api-v2)
- [https://developer.twitter.com/en](https://developer.twitter.com/en)
- [https://www.npmjs.com/package/cron](https://www.npmjs.com/package/cron)
- [https://www.npmjs.com/package/dotenv](https://www.npmjs.com/package/dotenv)
- [https://www.npmjs.com/package/cron](https://www.npmjs.com/package/cron)